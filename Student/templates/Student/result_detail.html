{% extends 'Student/base.html' %}
{% load static %}

{% block title %}Result â€“ {{ result.assignment.title }}{% endblock %}

{% block content %}

<div class="max-w-4xl mx-auto">

    <!-- Back Button -->
    <a href="{% url 'result' %}" 
       class="inline-flex items-center text-gm-primary hover:text-indigo-500 font-medium mb-6 transition">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        Back to Results
    </a>

    <!-- Glass Card -->
    <div class="bg-white/70 backdrop-blur-xl border border-white/40 shadow-xl rounded-2xl p-8">

        <!-- Header -->
        <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between border-b border-gray-200 pb-5 mb-8">
            <div>
                <h2 class="text-3xl font-extrabold text-gray-900">
                    {{ result.assignment.title }}
                </h2>
                <p class="text-sm text-gray-500 mt-1">
                    Graded on: {{ result.graded_date|date:"F d, Y" }}
                </p>
            </div>

            <!-- Score -->
            <div class="mt-4 sm:mt-0 text-left sm:text-right">
                <p class="text-5xl font-extrabold 
                    {% if result.score >= 90 %}text-green-600
                    {% elif result.score >= 80 %}text-blue-600
                    {% else %}text-yellow-500{% endif %}">
                    {{ result.score }} 
                    <span class="text-gray-400 text-3xl">/ {{ result.assignment.max_score }}</span>
                </p>

                <p class="text-lg font-semibold mt-1
                    {% if result.score >= 90 %}text-green-600
                    {% elif result.score >= 80 %}text-blue-600
                    {% else %}text-yellow-500{% endif %}">
                    {% if result.score >= 90 %}Excellent
                    {% elif result.score >= 80 %}Good
                    {% elif result.score >= 70 %}Fair
                    {% else %}Needs Improvement
                    {% endif %}
                </p>
            </div>
        </div>

        <!-- Teacher Feedback -->
        <div class="mb-10">
            <h3 class="text-2xl font-bold text-gray-900 mb-3">Instructor Feedback</h3>
            <div class="bg-gray-50 border border-gray-200 rounded-xl p-5 shadow-sm">
                {% if result.feedback %}
                    <p class="text-gray-700 leading-relaxed">{{ result.feedback|linebreaks }}</p>
                {% else %}
                    <p class="text-gray-500 italic">No feedback provided.</p>
                {% endif %}
            </div>
        </div>

        <!-- AI Evaluation Report -->
        <div class="mb-10">
            <h3 class="text-2xl font-bold text-gray-900 mb-3">AI Evaluation Report</h3>

            <div class="bg-indigo-50 border border-indigo-200 p-5 rounded-xl shadow-sm flex items-center gap-6">

                <!-- Circular Score -->
                <div class="relative w-24 h-24">
                    <svg class="w-full h-full" viewBox="0 0 36 36">
                        <circle cx="18" cy="18" r="16" class="text-gray-300" stroke="currentColor" stroke-width="3" fill="none"></circle>
                        <circle 
                            cx="18" cy="18" r="16"
                            class="text-red-500"
                            stroke="currentColor"
                            stroke-width="3"
                            stroke-dasharray="{{ result.plagiarism_score|default:0 }}, 100"
                            stroke-linecap="round"
                            fill="none"
                            transform="rotate(-90 18 18)">
                        </circle>
                    </svg>

                    <div class="absolute inset-0 flex items-center justify-center">
                        <span class="text-xl font-bold">{{ result.plagiarism_score|default:0 }}%</span>
                    </div>
                </div>

                <!-- Explanation -->
                <div>
                    <h4 class="text-lg font-semibold text-gray-900">Similarity / Plagiarism Score</h4>
                    <p class="text-gray-600 text-sm leading-relaxed mt-1">
                        This indicates how similar your submission is to online resources or previously submitted papers.
                    </p>
                </div>
            </div>
        </div>

        <!-- Student Submission -->
        <div class="pt-6 border-t border-gray-200">
            <h3 class="text-2xl font-bold text-gray-900 mb-4">Your Submission</h3>

            <div class="bg-gray-50 border border-gray-200 rounded-xl p-5 space-y-6 shadow-sm">

                {% if result.submission.text_submission %}
                <div>
                    <h4 class="font-semibold text-gray-700 mb-2">Submitted Text</h4>
                    <pre class="bg-white p-4 rounded-lg border border-gray-200 text-gray-700 whitespace-pre-wrap font-sans text-sm shadow-sm">
{{ result.submission.text_submission }}
                    </pre>
                </div>
                {% endif %}

                {% if result.submission.file_submission %}
                <div>
                    <h4 class="font-semibold text-gray-700 mb-2">Uploaded File</h4>

                    <a href="{{ result.submission.file_submission.url }}" download
                       class="inline-flex items-center gap-2 text-gm-primary hover:text-indigo-500 font-medium transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5"
                             fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" 
                                  d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M16 12l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        {{ result.submission.get_filename }}
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

    </div>
</div>

{% endblock %}
